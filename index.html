<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>edu_webhard - 파일 목록</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 720px; margin: 2em auto; padding: 0 1em; }
    h1 { font-size: 28px; margin-bottom: 1em; }
    ul { list-style: none; padding: 0; }
    li { margin-bottom: 0.7em; }
    a { text-decoration: none; color: #0366d6; }
    a:hover { text-decoration: underline; }
    .filename { font-weight: bold; }
  </style>
</head>
<body>
  <h1>업로드된 파일 목록</h1>
  <ul id="file-list">불러오는 중...</ul>

  <script>
    const repoOwner = "Dani-dev-6";
    const repoName = "edu_webhard";

    async function fetchIssues() {
      const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/issues?per_page=100`;
      try {
        const res = await fetch(apiUrl);
        if (!res.ok) {
          throw new Error(`GitHub API 오류: ${res.status}`);
        }
        const issues = await res.json();

        const fileLinks = [];

        for (const issue of issues) {
          if (!issue.title.includes("[업로드]")) continue;
          // 본문에서 user-images.githubusercontent.com 으로 시작하는 모든 URL 추출
          const urls = [...issue.body.matchAll(/https:\\/\\/user-images\\.githubusercontent\\.com\\/[^\\s)"]+/g)];
          for (const match of urls) {
            const url = match[0];
            // 파일명 추출 (URL 마지막 부분)
            let name = url.split("/").pop().split("?")[0];
            try {
              name = decodeURIComponent(name);
            } catch(e) {}
            fileLinks.push({ name, url });
          }
        }

        const list = document.getElementById("file-list");
        list.innerHTML = "";

        if (fileLinks.length === 0) {
          list.innerHTML = "<li>업로드된 파일이 없습니다.</li>";
          return;
        }

        // 중복 제거 (같은 URL이 여러 이슈에 있을 수 있으니)
        const uniqueFiles = {};
        for (const file of fileLinks) {
          uniqueFiles[file.url] = file.name;
        }

        for (const [url, name] of Object.entries(uniqueFiles)) {
          const li = document.createElement("li");
          li.innerHTML = `<a href="${url}" target="_blank" rel="noopener noreferrer"><span class="filename">${name}</span></a>`;
          list.appendChild(li);
        }

      } catch (e) {
        document.getElementById("file-list").innerHTML = `<li>오류 발생: ${e.message}</li>`;
      }
    }

    fetchIssues();
  </script>
    <a herf="https://github.com/Dani-dev-6/edu_webhard/issues/new?title=%5B%EC%97%85%EB%A1%9C%EB%93%9C%5D%20%ED%8C%8C%EC%9D%BC%EC%9D%B4%EB%A6%84.zip&body=%EC%B6%94%EA%B0%80%ED%95%A0%20%ED%8C%8C%EC%9D%BC%EC%9D%84%20%EC%B0%BE%EC%95%84%EC%84%9C%20%EC%97%85%EB%A1%9C%EB%93%9C%ED%95%B4%EC%A3%BC%EC%84%B8%EC%9A%94.%0A%0A%EC%B2%A8%EB%B6%80%ED%8C%8C%EC%9D%BC%3A"></a><button style="
    padding: 10px 20px;
    border: none;
    border-radius: 20px;
    background-color: #4CAF50;
    color: white;
    font-size: 16px;
    cursor: pointer;
    margin: 20px 0;
  ">
    </a>
    파일 업로드
    </button>
</body>
</html>
